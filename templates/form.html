<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบรับเรื่องร้องเรียน - ฟอร์ม</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('fda_scan.static', filename='css/style.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('fda_scan.static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('fda_scan.static', filename='css/form.css') }}">
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>แจ้งเรื่องร้องเรียนผลิตภัณฑ์</h1>
        </div>
        <form id="complaint-form" action="/fda_scan/form" method="POST" enctype="multipart/form-data">
            
            <input type="hidden" id="scanned_image_hidden_input" name="scanned_image" value="{{ scanned_image or '' }}">

            <div class="form-group">
                <label for="com_name">ชื่อจริง</label>
                <input type="text" class="form-control" id="com_name" name="com_name" value="{{ user_data.get('com_name', '') }}" required>
            </div>
            <div class="form-group">
                <label for="com_surname">นามสกุล</label>
                <input type="text" class="form-control" id="com_surname" name="com_surname" value="{{ user_data.get('com_surname', '') }}" required>
            </div>

            <div class="form-group">
                <label for="com_tel">เบอร์โทรศัพท์</label>
                <input type="tel" class="form-control" id="com_tel" name="com_tel" value="{{ user_data.get('com_tel', '') }}" required placeholder="0XX-XXX-XXXX" maxlength="12">
            </div>

            <div class="form-group">
                <label for="com_email">อีเมล</label>
                <input type="email" class="form-control" id="com_email" name="com_email" value="{{ user_data.get('com_email', '') }}" required placeholder="fda123@gmail.com">
            </div>

            <div class="form-group">
                <label for="com_code">เลขผลิตภัณฑ์ 13 หลัก</label>
                <input type="text" class="form-control" id="com_code" name="com_code" value="{{ com_code or '' }}" placeholder="กรอกเลขผลิตภัณฑ์ 13 หลักด้วยตนเอง" maxlength="17" required {% if is_from_scan %}readonly{% endif %}>
            </div>

            <div class="form-group">
                <label for="fdatype">หมวดหมู่ผลิตภัณฑ์</label>
                <select class="form-control" id="fdatype" name="fdatype" required>
                    <option value="">เลือกหมวดหมู่</option>
                </select>
            </div>

            <p style="font-weight: bold; margin-bottom: 10px;">สถานที่พบผลิตภัณฑ์</p>
            <div class="form-group">
                <label for="com_geographies">ภูมิภาค</label>
                <!-- START: แก้ไข name attribute -->
                <select class="form-control" id="com_geographies" name="com_geographies" required>
                <!-- END: แก้ไข -->
                    <option value="">เลือกภูมิภาค</option>
                </select>
            </div>
            <div class="form-group">
                <label for="province">จังหวัด</label>
                <!-- START: แก้ไข name attribute -->
                <select class="form-control" id="province" name="province" required disabled>
                <!-- END: แก้ไข -->
                    <option value="">เลือกจังหวัด</option>
                </select>
            </div>
            <div class="form-group">
                <label for="district">อำเภอ</label>
                <!-- START: แก้ไข name attribute -->
                <select class="form-control" id="district" name="district" required disabled>
                <!-- END: แก้ไข -->
                    <option value="">เลือกอำเภอ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="subdistrict">ตำบล</label>
                <!-- START: แก้ไข name attribute -->
                <select class="form-control" id="subdistrict" name="subdistrict" required disabled>
                <!-- END: แก้ไข -->
                    <option value="">เลือกตำบล</option>
                </select>
            </div>

            <div class="form-group">
                <label for="source">แหล่งที่มา</label>
                <input type="text" class="form-control" id="source" name="source" value="{{ user_data.get('source', '') }}" required placeholder="เช่น ร้านสะดวกซื้อ, แถวห้าง, อื่นๆ">
            </div>

            <div class="form-group">
                <label for="com_reported">เพราะเหตุใดถึงรายงาน</label>
                <textarea class="form-control" id="com_reported" name="com_reported" rows="3" required placeholder="เช่น มีการปลอมแปลงเลขผลิตภัณฑ์, สินค้าหมดอายุ, ลักษณะผิดปกติ"></textarea>
            </div>
            
            <div class="form-group">
                <label for="com_fda_real_data">ข้อมูลจากแหล่งตรวจสอบ อย.</label>
                <textarea class="form-control" id="com_fda_data" name="com_fda_data" rows="4" placeholder="ระบุข้อมูลที่ปรากฏบนฉลากผลิตภัณฑ์จริง (เช่น ชื่อผลิตภัณฑ์, ผลิตโดย)" {% if is_from_scan %}readonly{% endif %}>{{ com_fda_real_data or '' }}</textarea>
            </div>

            <div class="form-group">
                <label>รูปภาพจากการสแกน</label>
                <div id="imageUploadArea" class="file-upload-grid">
                    </div>
            </div>

            <div class="form-group">
                <label>เพิ่มรูปภาพที่ต้องการรายงาน (สูงสุด 4 รูปภาพ)</label>
                <div id="reportImageUploadArea" class="file-upload-grid">
                    <!-- พื้นที่สำหรับแสดงรูปและปุ่มบวกจะถูกสร้างโดย JavaScript -->
                </div>
            </div>

            <div class="text-center">
                <p class="form-note">
                    *หมายเหตุ: ฟอร์มการส่งคำร้องเรียนนี้ จะส่งไปยังผู้ใช้งานที่กรอกอีเมล และสำนักงานคณะกรรมการอาหารและยาโดยตรงผ่านทางอีเมล
                </p>
                <button type="submit" class="btn btn-primary">ส่งคำร้องเรียนผลิตภัณฑ์</button>
            </div>
        </form>

        <div id="scannedImageDisplay" class="scanned-image-container" style="display:none;">
            <p>รูปภาพจากหน้าสแกน:</p>
            <img id="scannedImagePreview" src="" alt="Scanned Image">
        </div>
        </div>

        <div id="loading-overlay">
            <div class="progress-circle" id="progress-circle">
                <span id="progress-percent">0%</span>
            </div>
            <div id="loading-text">
                <p>กำลังส่งคำร้องเรียนของคุณ...</p>
                <p>ระบบกำลังสร้างไฟล์ PDF และส่งอีเมล กรุณารอสักครู่</p>
            </div>
        </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="{{ url_for('fda_scan.static', filename='js/form.js') }}"></script>
</body>
</html>